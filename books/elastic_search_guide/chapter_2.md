# 02. 엘라스틱서치 살펴보기

엘라스틱 서치의 기본용어와 API 를 알아본다.

## 2.1 엘라스틱서치를 구성하는 개념

![엘라스틱 서치 데이터 구조](/img/A112.png)

### 2.1.1 기본 용어

#### 인덱스

* 데이터의 저장공간
* 하나의 인덱스는 하나의 타입만 가지며 하나의 물리적인 노드에 여려개의 논리적인 인덱스를 생성할 수 있다.
* 검색시 인덱스 이름으로 문서 데이터를 검색하며, 여러개의 인덱스를 동시에 검색하는것도 가능

#### 샤드

* 색인된 문서는 하나의 인덱스에 담기며 인덱스 내부에 색인된 데이터는 물리적 공간에 여려개의 파티션으로 나뉘어 구성되는데 이를 샤드라고 불린다.
* 엘라스틱 서치는 다수의 샤드로 문서를 분산 저장하고 있어 데이터 손실 위험을 최소화 한다.

#### 타입

* 인덱스의 논리적 구조를 의미
* 엘라스틱 서치 6.1 이상 버전에서는 하나의 인덱스당 하나의 타입만 설정가능

#### 문서

* 엘라스틱 서치에서 데이터가 저장되는 최소 단위
* 기본적으로 JSON 포맷

#### 필드

* 문서를 구성하기위한 속성
* 데이터베이스의 컬럼보다는 좀더 다이나믹 하며 유연하다.

#### 매핑

* 문서의 필드와 필드 속성을 정의하고 그에 따른 색인 방법을 정의하는 프로세스이다.

### 2.1.2 노드의 종류

#### 마스터 노드

* 인덱스를 생성, 삭제 하는등의 클러스터와 관련된 전반적인 작업을 담당한다.
* 네트워크 속도가 빠르고 지연이 없는 노드를 선택해야 함

#### 데이터 노드

* 문서가 실제로 저장되는 노드
* 색인 작업은 CPU, 메모리, 스토리지와 같은 컴퓨팅 리소스를 많이 소모하기 때문에 리소스 모니터링이 필요

#### 코디네이팅 노드

* 들어온 요청을 라운드로빈으로 분산시켜주는 도구

#### 인제스트 노드

* 색인에 앞서서 전처리하는 도구

### 2.1.3 클러스터, 노드, 샤드

레플리카 샤드를 통하여 장애 극복이 가능하다.

## 2.2. 엘라스틱서치에서 제공하는 주요 API

* 인덱스 관리 API (Indices API)
* 문서 관리 API (Document API)
* 검색 API (Search API)
* 집계 API (Aggregation API)

:::tip Index vs Indices

* Index : 색인 데이터
* Indexing : 색인을 하는 과정
* Indices : 매핑 정보를 저장하는 논리적인 데이터 공간
:::

**스키마리스 (Schemaless) 기능**

문서를 색인하기 위해서는 기본적으로 인덱스를 색성하는 과정이 필요한데 인덱스를 생성하는 과정 없이 문서를 추가하더라도 문서가 색인되도록 지원하는 일종의 편의 기능이다.

하지만 이는 _**성능과 밀접한 연관이 있기 때문에 특수한 상황에서만 사용**_ 해야 한다.

### 2.2.1 인덱스 관리 API

인덱스 관리 API 는 인덱스를 관리하기 위한 API 이다. 이를 이용하여 인덱스를 추가하거나 삭제할 수 있다.

인덱스 관리 API는 HTTP 메서드를 지정하는 방식을 통하여 사용할 수 있다.

#### 인덱스 생성

인덱스를 생성할 때는 매핑이라는 세부 설정을 이용할 수 있다.

매핑은 문서와 문서에 포함된 필드, 필드 타입을 세세하게 지정하는 것이 가능한 설정 방식이다.

한번 설정된 매핑 정보는 변경할 수 없으며 잘못 생성하거나 혹은 변경이 필요한 경우 데이터를 삭제하고 다시 색인해야 한다.

#### 인덱스 삭제

### 2.2.2 문서 관리 API

문서 관리 API는 한건의 문서를 처리하는 `Single document API` 와 다수의 문서를 처리하는 `Multi document API` 로 나뉜다.

#### Single Document API

* Index API : 한건의 문서를 색인한다.
* Get API : 한건의 문서를 조회한다.
* Delete API : 한건의 문서를 삭제한다.
* Update API : 한건의 문서를 업데이트한다.

#### Multi Document API

* Multi Get API : 다수의 문서를 조회한다.
* Bulk API : 대랑의 문서를 색인한다.
* Delete By Query API : 다수의 문서를 삭제한다.
* Update By Query API : 다수의 문서를 업데이트 한다.
* Reindex API : 인덱스 문서를 다시 색인한다.
